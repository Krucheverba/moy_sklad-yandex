# Инструкция по получению OAuth токена Яндекс.Маркет

## Проблема

Текущий токен в `.env` имеет формат `client_id:client_secret`, что **не является** OAuth токеном. Яндекс.Маркет API требует настоящий OAuth токен.

## Решение: Получить правильный OAuth токен

### Вариант 1: Через личный кабинет Яндекс.Маркет (РЕКОМЕНДУЕТСЯ)

Это самый простой способ для продавцов, у которых уже есть магазин на Яндекс.Маркет.

1. **Войдите в личный кабинет**
   - Перейдите на https://partner.market.yandex.ru/
   - Войдите под своим аккаунтом

2. **Откройте настройки API**
   - В левом меню найдите раздел **"Настройки"**
   - Выберите **"API"** или **"Интеграция"**

3. **Создайте токен**
   - Нажмите **"Создать токен"** или **"Получить токен"**
   - Выберите необходимые права доступа:
     - ✅ Чтение информации о товарах
     - ✅ Чтение информации о заказах
     - ✅ Управление заказами (если нужно)

4. **Скопируйте токен**
   - Токен будет показан **только один раз**!
   - Скопируйте его полностью
   - Токен должен быть длинной строкой **БЕЗ двоеточия**
   - Примерный формат: `AQAAAAABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789`

5. **Обновите .env файл**
   ```bash
   YANDEX_TOKEN=ваш_новый_токен_без_двоеточия
   ```

### Вариант 2: Через OAuth приложение (для разработчиков)

Если у вас нет доступа к личному кабинету или нужен токен для разработки:

1. **Зарегистрируйте OAuth приложение**
   - Перейдите на https://oauth.yandex.ru/
   - Войдите под своим Яндекс аккаунтом
   - Нажмите **"Зарегистрировать новое приложение"**

2. **Настройте приложение**
   - Название: `Интеграция с МойСклад` (или любое другое)
   - Платформы: выберите **"Веб-сервисы"**
   - Redirect URI: `https://oauth.yandex.ru/verification_code`
   - Права доступа:
     - ✅ `market:partner-api` - доступ к Partner API

3. **Получите Client ID и Client Secret**
   - После создания приложения вы получите:
     - Client ID (идентификатор приложения)
     - Client Secret (секретный ключ)

4. **Получите OAuth токен**
   
   **Шаг 1:** Откройте в браузере URL (замените `YOUR_CLIENT_ID`):
   ```
   https://oauth.yandex.ru/authorize?response_type=token&client_id=YOUR_CLIENT_ID
   ```
   
   **Шаг 2:** Разрешите доступ приложению
   
   **Шаг 3:** Вы будете перенаправлены на URL вида:
   ```
   https://oauth.yandex.ru/verification_code#access_token=ВАШТОКЕН&token_type=bearer&expires_in=31536000
   ```
   
   **Шаг 4:** Скопируйте значение `access_token` из URL

5. **Обновите .env файл**
   ```bash
   YANDEX_TOKEN=скопированный_access_token
   ```

## Проверка токена

После обновления токена в `.env`, запустите диагностику:

```bash
node diagnose-yandex-token.js
```

Вы должны увидеть:
```
✅ УСПЕХ! Токен работает!
```

## Частые ошибки

### ❌ "Authorization header has invalid syntax"
- **Причина:** Токен содержит двоеточие или имеет неправильный формат
- **Решение:** Получите новый OAuth токен по инструкции выше

### ❌ "OAuth token is invalid"
- **Причина:** Токен истёк или был отозван
- **Решение:** Создайте новый токен в личном кабинете

### ❌ "FORBIDDEN"
- **Причина:** У токена нет необходимых прав доступа
- **Решение:** Создайте новый токен с правами на Partner API

## Дополнительная информация

- **Документация Яндекс.Маркет API:** https://yandex.ru/dev/market/partner-api/doc/dg/concepts/about.html
- **OAuth Яндекс:** https://yandex.ru/dev/id/doc/ru/
- **Срок действия токена:** обычно 1 год, после чего нужно создать новый

## Что делать после получения токена

1. Обновите `YANDEX_TOKEN` в `.env`
2. Запустите диагностику: `node diagnose-yandex-token.js`
3. Если все тесты прошли, запустите генерацию маппинга: `node generate-mapping.js`
4. Проверьте файл `mapping.json` - в нём должны появиться ваши товары
